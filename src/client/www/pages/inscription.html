<template>
  <div class="page" data-name="home">
    <div class="appbar">
      <a href="#" class="link back">
        <i class="icon icon-back"></i>
        <span class="if-not-md">Back</span>
      </a>
      <div class="appbar-inner">
        FriendFinder
      </div>
    </div>
    <div class="page-content block ">
      <form method="post">
        <div class="formulaire">
          <label>Nom</label>
          <input id="input-name" type="text" name="user_name" placeholder="Entrer votre nom" required />
        </div>
        <div class="formulaire">
          <label>Prénom</label>
          <input id="input-surname" type="text" name="user_surname" placeholder="Entrer votre prénom" required />
        </div>
        <div class="formulaire">
          <label>Pseudo</label>
          <input id="input-pseudo" type="text" name="user_pseudo" placeholder="Entrer votre pseudo" required />
        </div>
        <div class="formulaire">
          <label>Date de naissance</label>
          <input id="input-birthday" type="date" name="user_birthday" placeholder="Entrer votre date de naissance" required />
        </div>
        <div class="formulaire">
          <label>Mail</label>
          <input id="input-mail" type="email" name="user_mail" placeholder="Entrer votre email" required />
        </div>
        <div class="formulaire">
          <label>Passeword</label>
          <input id="input-password" type="password" name="user_passeword" placeholder="Entrer votre mot de passe" required />
        </div>
        <div class="formulaire">
          <label>Confirmation</label>
          <input id="input-confirmation" type="password" name="user_confirm" placeholder="Confirmation mot de passe" required />
        </div>
        <div class="button">
          <button type="button" @click="valider" name="button">Valider</button>
        </div>
      </form>
    </div>
  </div>
</template>
<script>
  return{
    methods: {
      valider: function() {
        const name = document.querySelector('#input-name').value;
        const surname = document.querySelector('#input-surname').value;
        const pseudo = document.querySelector('#input-pseudo').value;
        const birthday = document.querySelector('#input-birthday').value;
        const mail = document.querySelector('#input-mail').value;
        const password = document.querySelector('#input-password').value;
        const confirmation = document.querySelector('#input-confirmation').value;
        if(password === confirmation){
          if(name && surname && mail && password && confirmation && pseudo){
            const url = "http://localhost:3000/users/";
            let chemin;
            const router = this.$router;
            const dialog = this.$app.dialog;
            fetch(url,{
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                name: name,
                surname: surname,
                pseudo: pseudo,
                birthday: birthday,
                mail: mail,
                password: password
              })
            })
            .then(function(response){
              if (response.ok) {
                chemin ="/";
                router.navigate(chemin);
              }
              else{
                response.json().then(data =>{dialog.alert(data.error)});
              }
            })
            .catch(err => this.$app.dialog.alert('Error ' + err.message));
          }
          else{
              this.$app.dialog.alert("Il manque des infos");
          }
        }
        else{
          this.$app.dialog.alert("La confirmation ne correspond pas");
        }
      }
    }
  }
</script>
