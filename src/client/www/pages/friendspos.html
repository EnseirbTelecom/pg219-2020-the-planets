<template>
    <div class="page" data-name="home">
        <div class="appbar">
            <a href="#" class="link back">
                <i class="icon icon-back"></i>
                <span class="if-not-md">Back</span>
            </a>
            <div class="appbar-inner">
                FriendFinder
            </div>
        </div>
        <div class="page-content">
            <div class="list simple-list">
                <ul>
                    {{#each friendsPos}}
                    <li>{{this.pseudo}}</li>
                    <li>{{this.latitude}}</li>
                    <li>{{this.longitude}}</li>
                    {{/each}}
                </ul>
            </div>
        </div>
    </div>
</template>
<script>
    return {
        data: function () {
            return {
                // empty initial user data
                friendsPos: null,
            }
        },
        on: {
            pageInit: function () {
                var self = this;


                fetch("http://localhost:3000/reqFriends/" + app.data.mail, {
                    method: "GET",

                })
                    .then(function (res) {
                        return res.json()
                            .then(function (data) {
                                console.log(data);
                                if (res.ok == true) {

                                    friendsPos = [];
                                    FrirendMail = null;

                                    var i;
                                    for (i = 0; i < data.length; i++) {
                                        if (data[i].mailSender != app.data.mail) {
                                            FrirendMail = data[i].mailSender;
                                        }
                                        else {
                                            FrirendMail = data[i].mailReceiver;
                                        }
                                        console.log(FrirendMail);

                                        fetch("http://localhost:3000/mypos/" + FrirendMail, {
                                            method: "GET",
                                        })
                                            .then(function (res1) {
                                                return res1.json()
                                                    .then(function (dataFriendpos) {


                                                        var j;
                                                        for (j = 0; j < dataFriendpos.length; j++) {
                                                            friendsPos.push({
                                                                pseudo:  dataFriendpos[j].pseudo,
                                                                latitude: dataFriendpos[j].latitude.toFixed(2),
                                                                longitude: dataFriendpos[j].longitude.toFixed(2),
                                                            });
                                                        }



                                                        console.log(friendsPos);

                                                        self.$setState({
                                                            friendsPos: friendsPos,
                                                        });
                                                    });


                                            })






                                    }
                                }

                                else console.log("error");

                            })
                    });
            },
        }
    }
</script>