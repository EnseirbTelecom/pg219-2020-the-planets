
<template>
  <div class="page" data-name="home">
   
    <!-- Appbar -->
    <div class="appbar">
      <div class="appbar-inner">
        Friends
      </div>
    </div>
    
    <!-- Scrollable page content-->
    <div class="page-content">
      
      <div class="block-title">Liste des amis.</div>
      
      <div class="list links-list">
        <ul>
          {{#each friendName}}
          <a href="/friends/{{_id}}"><li>Vous êtes ami avec {{firstName}} {{lastName}}</li></a>
          {{/each}}
        </ul>
      </div>

      <div class="block-title">Liste des demandes que vous avez envoyées</div>

      <div class="list links-list">
        <ul>
          {{#each receiverName}}
          <a href="/friends/{{_id}}"><li>Vous avez envoyé une demande à {{firstName}} {{lastName}}</li></a>
          {{/each}}
        </ul>
      </div>
      
      <div class="block-title">Liste des demandes à valider</div>

      <div class="list links-list">
        <ul>
          {{#each senderName}}
          <a href="/friends/{{_id}}"><li>{{firstName}} {{lastName}} vous a envoyé une demande</li></a>
          {{/each}}
        </ul>
      </div>
    </div>

    <div class="fab fab-center-center">
      <a @click="add" href="#">
        <i class="icon f7-icons">plus</i>
      </a>
    </div>

    <div class="fab fab-center-bottom">
      <a @click="ho" href="#">
        <i class="icon f7-icons">minus</i>
      </a>
    </div>

  </div>

</template>


<script>
  return {
    async data() {

      const USER = "j22.dubreuil@gmail.com"; // utilisateur connecté /!\ voir avec Jérémy
      
      try {
        
        // récuperation des demandes d'amis envoyées
        var receiver = [];
        receiver = await fetch("http://localhost:3000/reqFriendSender/" + USER)
          .then(res => res.json());

        // récuperation des noms des demandes d'amis envoyées
        var receiverName = [];
        for (let i = 0; i < receiver.length; i++) {
          let temp = await fetch("http://localhost:3000/friendName/" + receiver[i].mailReceiver)
            .then(res => res.json());
            receiverName.push(temp[0]);
        }

        // récuperation des demandes d'amis reçues
        var sender = [];
        sender = await fetch("http://localhost:3000/reqFriendReceiver/" + USER)
          .then(res => res.json());

        // récuperation des noms des demandes d'amis reçues
        var senderName = [];
        for (let i = 0; i < sender.length; i++) {
          let temp = await fetch("http://localhost:3000/friendName/" + sender[i].mailSender)
            .then(res => res.json());
          senderName.push(temp[0]);
        }

        // récuperation des amis
        var friend = [];
        friend = await fetch("http://localhost:3000/reqFriends/" + USER)
          .then(res => res.json());

        // récuperation des noms des amis
        var friendName = [];
        for (let i = 0; i < friend.length; i++) {
          const friendi = Object.values(friend[i]);
          if (friendi[1] === USER) {
            let temp = await fetch("http://localhost:3000/friendName/" + friendi[2])
              .then(res => res.json());
          }
          else {
            temp = await fetch("http://localhost:3000/friendName/" + friendi[1])
              .then(res => res.json());
          }
          friendName.push(temp[0]);
        }

      } catch(err) {
        this.$app.dialog.alert("Error " + err);
      }

      return { receiver: receiver, sender: sender, friend: friend, receiverName: receiverName , senderName: senderName, friendName: friendName};
    },

    
    methods: {
      add: function() {
        this.$router.navigate("/friends/");
      },
      ho: function() {
        this.$router.navigate("/");
      },
    }
  }
</script>