<!-- Cette page permet d'afficher les amitiés,
     les requêtes reçues et les requêtes envoyées -->

<!-- ===================== -->
<!-- ===   PAGE HTML   === -->
<!-- ===================== -->

<template>
  <div class="page" data-name="home">

    <!-- Appbar -->
    <div class="appbar">
      <div class="appbar-inner">
        Amis
        <div class="col"><a @click="ho" class="button" href="#">Accueil</a></div>
      </div>
    </div>

    <!-- Scrollable page content -->
    <div class="page-content">

      <div class="block-title">Liste des demandes envoyées : </div>

      <div class="list links-list">
        <ul>
          {{#each receiverName}}
          <a href="/friendRequestSender/{{mail}}?">
            <li>Vous avez envoyé une demande à {{surname}} {{name}}</li>
          </a>
          {{/each}}
        </ul>
      </div>

      <div class="block-title">Liste des demandes reçues : </div>

      <div class="list links-list">
        <ul>
          {{#each senderName}}
          <a href="/friendRequestReceiver/{{mail}}">
            <li>{{surname}} {{name}} vous a envoyé une demande</li>
          </a>
          {{/each}}
        </ul>
      </div>

      <div class="block block-strong col">
        <div class="col">
          <a class="button" href="/postpos">Post my position</a>
        </div>
      </div>
      <div class="block block-strong col">
        <div class="col">
          <a class="button" href="/map">Show map</a>
        </div>
      </div>
      <div class="block block-strong col">
        <div class="col">
          <a class="button" href="/friendspos">See friends pos</a>
        </div>
      </div>
      <div class="block block-strong col">
        <div class="col">
          <a class="button" href="/historique">Historique</a>
        </div>
      </div>
      <div class="block block-strong col">
        <div class="col">
          <a class="button" href="/FriendList">Friend List</a>
        </div>
      </div>
      <br>
      <br>
      <br>
    </div>



    <div class="fab fab-center-center">
      <a @click="add" href="#">
        <i class="icon f7-icons">plus</i>
      </a>
    </div>
  </div>

  </div>

</template>


<!-- =========================== -->
<!-- ===   CODE JAVASCRIPT   === -->
<!-- =========================== -->

<script>
  return {

    // ===============================================
    // fonction qui s'exécute au chargement de la page
    async data() {
      try {
        // récuperation des demandes d'amis envoyées
        var receiver = [];
        receiver = await fetch("http://localhost:3000/reqFriendSender/" + this.$app.data.mail)
          .then(res => res.json());

        // récupération des noms des demandes d'amis envoyées
        var receiverName = [];
        console.log(receiver);
        for (let i = 0; i < receiver.length; i++) {
          let temp = await fetch("http://localhost:3000/friendName/" + receiver[i].mailReceiver)
            .then(res => res.json());
          console.log(temp[0]);
          receiverName.push(temp[0]);
        }

        // récupération des demandes d'amis reçues
        var sender = [];
        sender = await fetch("http://localhost:3000/reqFriendReceiver/" + this.$app.data.mail)
          .then(res => res.json());

        // récupération des noms des demandes d'amis reçues
        var senderName = [];
        for (let i = 0; i < sender.length; i++) {
          let temp = await fetch("http://localhost:3000/friendName/" + sender[i].mailSender)
            .then(res => res.json());
          senderName.push(temp[0]);
        }


      } catch (err) {
        this.$app.dialog.alert("Error " + err);
      }

      return { receiverName: receiverName, senderName: senderName };
    },

    methods: {
      // fonction bouton ajouter un ami
      add: function () {
        this.$router.navigate("/friendRequestReceiver/");
      },

      // fonction bouton retour à la page d'accueil
      ho: function () {
        this.$router.navigate("/devFriends");
      },
    }
  }
</script>
